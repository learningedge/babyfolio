<div class="container settings registration-process">
  <% if family_registration? %>
    <%= render "shared/registration_steps", :current_step => 2 %>
  <% end %>

  <div id="left">
    <div class="title">Part A: Add Photos for <%= @selected_child.first_name -%></div>
  </div>

  <div class="user-form">

    <h1>Add Photos:</h1>

    <ul class="add-photos">
      <li>
        <h2>1. Import your photos from another site:</h2>
        <ul class="socials-container">
          <li id="facebook-ajax-container" class="ajax-container registration" child_id="<%= @selected_child.id -%>">
            <%= render :partial => 'registration/upload_photos/facebook/select_facebook_photos'-%>
          </li>

          <li id="flickr-ajax-container" class="ajax-container registration" child_id="<%= @selected_child.id -%>">
            <%= render :partial => 'registration/upload_photos/flickr/select_flickr_photos'-%>
          </li>

        </ul>
      </li>
      <li>
        <h2>2. Select photos from your computer harddrive:</h2>
        <ul class="socials-container">
          <li id="uploaded-images-ajax-container" class="ajax-container multiselect">
            <%= render :partial => 'registration/upload_photos/uploaded_images/select_uploaded_images' %>
          </li>
        </ul>
      </li>
    </ul>

    <div class="main-buttons-container">
      <%= link_to "Add Videos",import_videos_moments_path(:child_id => @selected_child.id), :class => "submit-button" -%>
      <%= link_to "Skip",import_videos_moments_path(:child_id => @selected_child.id), :class => "submit-button" -%>
    </div>
  </div>
  
  <script type="text/javascript">
    jQuery(function($){

      /************* flickr *************************/

      jQuery('.flickr .image').live({
        mouseover: function(){
            $(this).find('.thumb').stop().animate({opacity: 1});
            $('.flickr .image .thumb').not($(this).find('.thumb')).stop().animate({opacity: 0.5});
        },
        mouseleave: function(){
            $('.flickr .image .thumb').stop().animate({opacity: 1});
        }
      })

      $('#flickr-ajax-container form').live("ajax:before",function(){
        flickr_loader_start();
        $(this).find('input[type=hidden]').attr('value',$(this).parents('#flickr-ajax-container').attr("child_id"));
      }).live("ajax:success",function(){        
        flickr_loader_stop();
        go_to_flickr_sets();
        imported_message('#flickr-ajax-container','Flickr images imported');
      })      

      /************* facebook ***********************/

      $('#facebook-ajax-container form').live("ajax:before",function(){
        facebook_loader_start();
        $(this).find('input[type=hidden]').attr('value',$(this).parents('#facebook-ajax-container').attr("child_id"));
      }).live("ajax:success",function(){
        facebook_loader_stop();
        go_to_facebook_albums();
        imported_message($('#facebook-ajax-container'));
      })

      jQuery('.facebook .image').live({
        mouseover: function(){
            $(this).find('.thumb').stop().animate({opacity: 1});
            $('.facebook .image .thumb').not($(this).find('.thumb')).stop().animate({opacity: 0.5});
        },
        mouseleave: function(){
            $('.facebook .image .thumb').stop().animate({opacity: 1});
        }
      })

      /************* uploded images *****************/

      $('#uploaded-images-ajax-container form').live("ajax:before",function(){        
        uploaded_images_loader_start();
      }).live("ajax:success",function(){        
        uploaded_images_loader_stop();
        imported_message($('#uploaded-images-ajax-container'));
      })

    })

    /*************** ONCLICK FUNCTIONS **************/

    /*************** flickr *************************/

    function flickr_loader_start(){
      $('#flickr-ajax-container .preloader').stop().show().css({opacity: 0}).animate({opacity: 0.8});
    }
    
    function flickr_loader_stop(){
      $('#flickr-ajax-container .preloader').stop().fadeOut();
    }
    
    function go_to_flickr_photos(set_id){
      flickr_loader_start();
      $.post('<%= registration_add_photos_flickr_photos_url %>',{set_id:set_id},function(data){
        $('#flickr-ajax-grid').html(data);
        flickr_loader_stop();
      });
      return false;
    }

    function go_to_flickr_sets(){
      flickr_loader_start()
      $.post('<%= registration_add_photos_flickr_sets_url -%>',function(data){
        $('#flickr-ajax-grid').html(data);
        flickr_loader_stop();
      });
      return false;
    }

    function select_flickr_photo(object){      
      if($(object).find("input").attr("checked")){
        $(object).find("input").attr("checked",false);
        $(object).removeClass('selected');
      } else {
        $(object).addClass('selected');
        $(object).find("input").attr("checked",true);
      }      
    }
    
    /*************** facebook ***********************/
    
    function facebook_loader_start(){
      $('#facebook-ajax-container .preloader').stop().show().css({opacity: 0}).animate({opacity: 0.8});
    }

    function facebook_loader_stop(){
      $('#facebook-ajax-container .preloader').stop().fadeOut()
    }

    function go_to_facebook_photos(album_id){
      facebook_loader_start();
      $.post('<%= registration_add_photos_facebook_photos_url %>',{album:album_id},function(data){
        $('#facebook-ajax-grid').html(data);
        facebook_loader_stop();
      });
      return false;
    }

    function go_to_facebook_albums(){
      facebook_loader_start();
      $.post('<%= registration_add_photos_facebook_albums_url -%>',function(data){
        $('#facebook-ajax-grid').html(data);
        facebook_loader_stop();
      });
      return false;
    }

    function select_facebook_photo(object){
      if($(object).find("input").attr("checked")){
        $(object).find("input").attr("checked",false);
        $(object).removeClass('selected');
      } else {
        $(object).addClass('selected');
        $(object).find("input").attr("checked",true);
      }
    }

    /*************** uploaded images *****************/

    function uploaded_images_loader_start(){
      $('#uploaded-images-ajax-container .preloader').stop().show().css({opacity: 0}).animate({opacity: 0.8});
    }

    function uploaded_images_loader_stop(){
      $('#uploaded-images-ajax-container .preloader').stop().fadeOut();
    }

    function remove_element(object){
      $(object).remove();
    }

    function imported_message(container){
      var object = $(container).find('.imported-message');
      object.fadeIn();
      setTimeout(function(){
        object.fadeOut();
      },4000);
    }

  </script>    
    
  <div class="clear"></div>
</div>
