<div class="container settings create-family">
  <% if flash[:registration] %>
    <div id="steps">
      <table>
        <tr>
          <td class="title active">Step 1:<br/>Create family</td>
          <td class="arrows" ></td>
          <td class="title">Step 2:<br/>Invite Family Members</td>
          <td class="arrows" ></td>
          <td class="title">Step 3:<br/>Add Photos/Videos</td>
        </tr>
      </table>
    </div>
  <% end %>
  
  <div id="left">
    <div class="title">Step 1: Create family</div>  
  </div>
  <div class="user-form">
    <%= render "shared/error_messages", :target => @family %>
    <% counter = 0 %>

    <%= form_for @family do |f| -%>
      <h2>Family Name:</h2>
      <div class="row">
        <%= f.text_field :name %>
      </div>
      <h2>Children:</h2>
      <div>
        <%= f.fields_for :children do |child_form| %>
          <div class="single_child row" style="<%=  'display: block' if (child_form.object.first_name or child_form.object.birth_date) %>">
            <%= child_form.label :first_name, "First Name: "%>
            <%= child_form.text_field :first_name, :class => 'first_name_input' %>
            <%= child_form.label :birth_date, "Birth Date: "%>
            <%= child_form.text_field :birth_date, { :value => child_form.object.formated_birth_date,  :class => 'birth_date_input' } %>
	    <%= child_form.media do |media_form| -%>
	      
	       <%= media_form.file_field :image -%>

	    <% end %>
            <% counter += 1 %>
          </div>
        <% end %>
        <%= link_to "Add Another Child" , '#', { :class => 'add_child_btn' } -%>
      </div>

      <h2>
        <br/>
        Parents:
      </h2>
        <% index = 1 %>
      <div>
        <%= f.fields_for :relations do |relation_form| %>
          <div class="single_parent row">
            <%= relation_form.label :display_name, "Parent #{index}: "%>
            <%= relation_form.text_field :display_name, :value => relation_form.object.user.get_user_name %>
            <%= relation_form.fields_for :user do |user_form| %>
              <% if(user_form.object.email == current_user.email) %>
                <span>(You)</span>
                <%=  user_form.hidden_field :email %>
                <span class="select">
                <%= relation_form.select :member_type, options_for_select(Relation::PARENTS), :selected => Relation::MEMBER_TYPE[:MOTHER] -%>

                </span>

              <% else %>
                <%= relation_form.select :member_type, options_for_select(Relation::PARENTS, :selected => Relation::MEMBER_TYPE[:MOTHER]) -%>
                <div class="email">
                <%= user_form.label :email, "Email: "%>
                <%= user_form.text_field :email %>
                </div>
              <% end %>
            <% end %>
          </div>
          <% index += 1 %>
        <% end %>
      </div>

      <div class="row">        
        <%= f.label :zip_code, "Zip Code: " %>
        <%= f.text_field :zip_code %>
      </div>

      <div class="submit">
        <%= f.submit "Create" %>
      </div>
    <% end %>
  </div>
  <div class="clear"></div>
</div>


<script type="text/javascript">

  $(function() {
    $('.add_child_btn').click(function() {
    
      var hidden_children = $('.single_child').siblings('.single_child:hidden');
      hidden_children.first().fadeIn();
      
      if(hidden_children.length <= 1) {
        $(this).fadeOut();
      }
      
      return false;
      
    });
    $('.birth_date_input').datepicker({ changeYear: true, maxDate: '+0'});
  });
</script>
