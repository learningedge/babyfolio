<% content_for :middle_bar do %>
  <div id="timeline-notice" class="round-corners">
    <img src="/images/child_head_small.png" />
    <span><%= current_child.first_name %> has already...</span>
  </div>

<% end %>

  <div id="timeline-wrapper">
    <div id="timeline-left">
      <div id="drop_list">              
                <%= select_tag "people", options_for_select(@children.map { |c| ["#{c.first_name}'s Profile", c.id] }.insert(0, ["Select baby", nil])), {:onChange => "changeChild(this);" } -%>                
      </div>

      <div class="child-image-large shadow round-corners" style="<%= "background-image: url(#{@selected_child.media.image.url(:profile_large)})" if @selected_child.media.present? %>"></div>

      <div id="add-entry-tabs">
        <ul>
          <li><a href="#add-play">Play</a></li>
          <li><a href="#add-watch">Watch</a></li>
          <li><a href="#add-reflect">Reflect</a></li>
          <li><a href="#add-likes">Likes</a></li>
          <li><a href="#add-dislikes">Dislikes</a></li>
        </ul>

        <div id="add-play" class="tab">
          <div class="arrow-pointer"></div>
          <div class="add-entry-content">
            <%= render :partial => 'form', :locals => { :type => "play" } %>
          </div>
        </div>
        <div id="add-watch" class="tab">
          <div class="arrow-pointer"></div>
          <div class="add-entry-content">
            <%= render :partial => 'form', :locals => { :type => "watch" } %>
          </div>
        </div>
        <div id="add-reflect" class="tab">
          <div class="arrow-pointer"></div>
          <div class="add-entry-content">
            <%= render :partial => 'form', :locals => { :type => "reflect" } %>
          </div>
        </div>
        <div id="add-likes" class="tab">
          <div class="arrow-pointer"></div>
          <div class="add-entry-content">
            <%= render :partial => 'form', :locals => { :type => "likes" } %>
          </div>
        </div>
        <div id="add-dislikes" class="tab">
          <div class="arrow-pointer"></div>
          <div class="add-entry-content">
            <%= render :partial => 'form', :locals => { :type => "dislikes" } %>
          </div>
        </div>
      </div>
    </div>

    <ul id="timeline-right">
      <% @timeline_entries.each do |te| %>
      <li class="single-timeline-entry">
          <span class="entry-avatar round-corners"><%= image_tag @selected_child.media.image.url(:profile_small) if @selected_child.media.present? %></span>
          <div class="single-timeline-entry-inner">
            <div class="te-arrow-left"></div>
            <div class="te-box">
              <div class="te-header">
                <span class="te-category">
                  <%= image_tag "/images/icon_teal_#{te.category}.png" if te.category%>                  
                  <p><%= category_name(te.category) if te.category %></p>
                </span>
                <span class="te-date">
                  <%= te.published %>
                </span>
                <span class="te-title">
                  <%= te.title %>
                </span>                               
                <div class="clear"></div>
              </div>

              <div class="te-image-wrapper">
                <%= image_tag te.media.first.image.url(:attachment_large), :class => "round-corners" if te.media.present? %>                
              </div>

              <div class="te-comments">
                <%= form_tag add_timeline_comment_path, :class => "comment-form" do %>
                  <%= submit_tag "Post comment", :class => "comment-balloon" %>
                  <%= hidden_field_tag "te_id", te.id %>
                  <%= text_field_tag "text", nil, :id => "comment-input-#{te.id}", :class => "comment-input"  %>
                <% end %>
                <div class="comments-wrapper">
                  <% te.comments.reverse.each do |c| %>
                      <div class="single-comment">
                        <span class="comment-author-img">
                          <%= image_tag c.author.profile_media.image.url(:profile_tiny), :class => "round-corners" if c.author.profile_media  %>                          
                        </span>
                        <span class="comment-date"><%= c.published %></span>                        
                        <span class="comment-content"><span class="comment-author-name"><%= c.author.get_user_name %>: </span><%= c.text %></span>
                      </div>
                  <% end %>

                </div>
              </div>
                
            </div>
            
          </div>
      </li>
      <% end %>
      <li class="single-timeline-entry">
        <span class="entry-avatar round-corners"><%= image_tag @selected_child.media.image.url(:profile_small), :class => "entry-avatar round-corners" if @selected_child.media.present? %></span>
        <div class="single-timeline-entry-inner">
            <div class="te-arrow-left te-arrow-join"></div>
            <div class="te-box te-box-join">
                <span class="te-joined-image">
                  <img src="/images/timeline_joined_icon.png" />
                </span>
                <span class="joined-date"><%= current_child.joined %></span>
                <span class="te-title"><%= current_child.first_name %> started his BabyFolio.</span>
            </div>
        </div>
      </li>
    </ul>
  </div>

  
  <script type="text/javascript">
    $(function() {
      $('#add-entry-tabs').tabs({active: 0});
    });


    function changeChild(item) {
      if($(item).val()) {
        document.location = '/timeline/' + $(item).val();
      }
      return false;
    }
  </script>

